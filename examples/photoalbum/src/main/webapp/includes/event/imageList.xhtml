<!--
  JBoss, Home of Professional Open Source
  Copyright 2013, Red Hat, Inc. and individual contributors
  by the @authors tag. See the copyright.txt in the distribution for a
  full listing of individual contributors.

  This is free software; you can redistribute it and/or modify it
  under the terms of the GNU Lesser General Public License as
  published by the Free Software Foundation; either version 2.1 of
  the License, or (at your option) any later version.

  This software is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public
  License along with this software; if not, write to the Free
  Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
  02110-1301 USA, or see the FSF site: http://www.fsf.org.
  -->

<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:r="http://richfaces.org/rich"
    xmlns:richx="http://richfaces.org/richx">

    <r:outputPanel id="photoPanel">
        <r:dataGrid rendered="#{fn:length(eventAlbumsHelper.eventPhotos) > 0}" value="#{eventAlbumsHelper.eventPhotos}"
            var="photo" columns="5" id="photos">
            <r:outputPanel>
                <h:graphicImage id="img" url="#{photo.getString('thumbUrl')}" style="max-width: 140px; max-height: 140px"
                    styleClass="album-cover-image" />
                <!-- <h:outputText value="#{photo.toString()}" /> -->
            </r:outputPanel>
            <f:facet name="footer">
                <r:dataScroller />
            </f:facet>
        </r:dataGrid>
    </r:outputPanel>

    <!-- JavaScript -->
    <r:jsFunction name="initHelper" actionListener="#{eventAlbumsHelper.init()}" execute="@this" render="gImagePoll, photoPanel" />

    <r:jsFunction name="processAlbum" execute="@this" oncomplete="loadNextAlbum()">
        <r:param assignTo="#{googlePlusAlbumCache.albumAndImages}" name="response" />
    </r:jsFunction>

    <r:jsFunction name="loadNextAlbum" actionListener="#{eventAlbumsHelper.loadNext}" execute="@this"
        render="photoPanel, gImagePoll" />

    <h:outputScript>
        $(document).ready(function() {
                    initHelper();
                });
    </h:outputScript>

    <r:poll interval="1000" id="gImagePoll" enabled="#{eventAlbumsHelper.pollEnabled}"
        ontimer="if(#{eventAlbumsHelper.nextId != '0'}){G.getAlbumAndPhotos('#{eventAlbumsHelper.nextId}', processAlbum); enablePoll(false);}"
        execute="@this" render="@this" />

    <r:jsFunction name="enablePoll" execute="@this">
        <r:param name="enabled" assignTo="#{eventAlbumsHelper.pollEnabled}" />
    </r:jsFunction>
</ui:composition>